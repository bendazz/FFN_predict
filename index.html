<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regression Prediction Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .problem-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .problem-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .problem-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .problem-btn.active {
            background: #667eea;
            color: white;
        }
        
        .problem-container {
            display: none;
        }
        
        .problem-container.active {
            display: block;
        }
        
        .context {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .context h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .context p {
            color: #555;
            line-height: 1.6;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            overflow-x: auto;
            display: block;
        }
        
        .data-table table {
            width: 100%;
            min-width: 400px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        .data-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .prediction-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        .prediction-section h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .input-group label {
            font-weight: 600;
            color: #333;
        }
        
        .input-group input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            width: 150px;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .prediction-input {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1.1em;
            width: 200px;
        }
        
        .prediction-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .result-section {
            display: none;
            background: #d4edda;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }
        
        .result-section.show {
            display: block;
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-section h4 {
            color: #155724;
            margin-bottom: 15px;
        }
        
        .result-section p {
            color: #155724;
            line-height: 1.8;
            margin-bottom: 10px;
        }
        
        .equation {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 1.1em;
            color: #333;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .comparison-box {
            padding: 15px;
            background: white;
            border-radius: 5px;
        }
        
        .comparison-box h5 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .comparison-box .value {
            font-size: 1.3em;
            font-weight: 600;
            color: #667eea;
        }
        
        @media (max-width: 600px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Regression Prediction Practice</h1>
        <p class="subtitle">Practice your regression analysis skills with real-world problems</p>
        
        <div class="problem-selector" id="problemSelector"></div>
        
        <div id="problemsContainer"></div>
    </div>

    <script>
        // Regression calculation functions
        class RegressionCalculator {
            // Simple Linear Regression (1 feature)
            static simpleLinearRegression(X, y) {
                const n = X.length;
                const sumX = X.reduce((a, b) => a + b, 0);
                const sumY = y.reduce((a, b) => a + b, 0);
                const sumXY = X.reduce((sum, x, i) => sum + x * y[i], 0);
                const sumX2 = X.reduce((sum, x) => sum + x * x, 0);
                
                const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;
                
                return { coefficients: [intercept, slope] };
            }
            
            // Multiple Linear Regression using Normal Equation
            static multipleLinearRegression(X, y) {
                // Add intercept column (column of 1s) to X
                const X_with_intercept = X.map(row => [1, ...row]);
                
                // Calculate (X^T * X)
                const XtX = this.matrixMultiply(
                    this.transpose(X_with_intercept),
                    X_with_intercept
                );
                
                // Calculate (X^T * y)
                const Xty = this.matrixVectorMultiply(
                    this.transpose(X_with_intercept),
                    y
                );
                
                // Solve (X^T * X)^-1 * (X^T * y)
                const coefficients = this.solveLinearSystem(XtX, Xty);
                
                return { coefficients };
            }
            
            static transpose(matrix) {
                return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));
            }
            
            static matrixMultiply(A, B) {
                const result = [];
                for (let i = 0; i < A.length; i++) {
                    result[i] = [];
                    for (let j = 0; j < B[0].length; j++) {
                        let sum = 0;
                        for (let k = 0; k < A[0].length; k++) {
                            sum += A[i][k] * B[k][j];
                        }
                        result[i][j] = sum;
                    }
                }
                return result;
            }
            
            static matrixVectorMultiply(matrix, vector) {
                return matrix.map(row => 
                    row.reduce((sum, val, i) => sum + val * vector[i], 0)
                );
            }
            
            // Solve linear system using Gaussian elimination
            static solveLinearSystem(A, b) {
                const n = A.length;
                const augmented = A.map((row, i) => [...row, b[i]]);
                
                // Forward elimination
                for (let i = 0; i < n; i++) {
                    // Find pivot
                    let maxRow = i;
                    for (let k = i + 1; k < n; k++) {
                        if (Math.abs(augmented[k][i]) > Math.abs(augmented[maxRow][i])) {
                            maxRow = k;
                        }
                    }
                    [augmented[i], augmented[maxRow]] = [augmented[maxRow], augmented[i]];
                    
                    // Eliminate column
                    for (let k = i + 1; k < n; k++) {
                        const factor = augmented[k][i] / augmented[i][i];
                        for (let j = i; j <= n; j++) {
                            augmented[k][j] -= factor * augmented[i][j];
                        }
                    }
                }
                
                // Back substitution
                const x = new Array(n);
                for (let i = n - 1; i >= 0; i--) {
                    x[i] = augmented[i][n];
                    for (let j = i + 1; j < n; j++) {
                        x[i] -= augmented[i][j] * x[j];
                    }
                    x[i] /= augmented[i][i];
                }
                
                return x;
            }
            
            static predict(coefficients, features) {
                // coefficients[0] is intercept, rest are feature coefficients
                let prediction = coefficients[0];
                for (let i = 0; i < features.length; i++) {
                    prediction += coefficients[i + 1] * features[i];
                }
                return prediction;
            }
        }

        // Problem definitions
        const problems = [
            {
                id: 1,
                title: "House Price Prediction",
                context: "A real estate agent has collected data on house prices and their sizes in a neighborhood. Help predict the price of a new house based on its square footage.",
                features: ["Square Feet"],
                target: "Price ($1000s)",
                data: [
                    { x: [1000], y: 150 },
                    { x: [1200], y: 180 },
                    { x: [1400], y: 210 },
                    { x: [1600], y: 240 },
                    { x: [1800], y: 270 },
                    { x: [2000], y: 300 },
                    { x: [2200], y: 330 }
                ],
                question: "What would be the predicted price for a house with 1500 square feet?",
                testInput: [1500]
            },
            {
                id: 2,
                title: "Student Exam Score",
                context: "A teacher wants to understand the relationship between study hours and exam scores. Based on past student data, predict how well a student will perform.",
                features: ["Study Hours"],
                target: "Exam Score (%)",
                data: [
                    { x: [2], y: 55 },
                    { x: [3], y: 62 },
                    { x: [4], y: 68 },
                    { x: [5], y: 75 },
                    { x: [6], y: 82 },
                    { x: [7], y: 88 },
                    { x: [8], y: 93 }
                ],
                question: "What score would you predict for a student who studies 5.5 hours?",
                testInput: [5.5]
            },
            {
                id: 3,
                title: "Car Fuel Efficiency",
                context: "An automotive engineer is analyzing how car weight and engine size affect fuel efficiency (MPG). Help predict the fuel efficiency for a new car model.",
                features: ["Weight (1000 lbs)", "Engine Size (L)"],
                target: "MPG",
                data: [
                    { x: [2.5, 1.6], y: 32 },
                    { x: [3.0, 2.0], y: 28 },
                    { x: [3.5, 2.4], y: 24 },
                    { x: [2.8, 1.8], y: 30 },
                    { x: [4.0, 3.0], y: 20 },
                    { x: [2.2, 1.4], y: 35 },
                    { x: [3.2, 2.2], y: 26 }
                ],
                question: "Predict the MPG for a car weighing 3000 lbs with a 2.0L engine.",
                testInput: [3.0, 2.0]
            },
            {
                id: 4,
                title: "Employee Salary Prediction",
                context: "An HR department wants to ensure fair compensation. They've analyzed how years of experience and education level (years) affect salaries. Predict a fair salary for a new hire.",
                features: ["Years Experience", "Years Education"],
                target: "Salary ($1000s)",
                data: [
                    { x: [1, 16], y: 45 },
                    { x: [3, 16], y: 55 },
                    { x: [5, 18], y: 70 },
                    { x: [7, 18], y: 80 },
                    { x: [2, 14], y: 42 },
                    { x: [10, 20], y: 95 },
                    { x: [6, 16], y: 72 },
                    { x: [4, 18], y: 62 }
                ],
                question: "What salary would you predict for someone with 5 years experience and 17 years of education?",
                testInput: [5, 17]
            },
            {
                id: 5,
                title: "Ice Cream Sales Prediction",
                context: "An ice cream shop owner has noticed that sales vary with temperature and the day of the week. Help predict tomorrow's sales based on weather forecast and customer patterns.",
                features: ["Temperature (¬∞F)", "Weekend (0=No, 1=Yes)"],
                target: "Sales ($100s)",
                data: [
                    { x: [65, 0], y: 15 },
                    { x: [70, 0], y: 18 },
                    { x: [75, 1], y: 28 },
                    { x: [80, 1], y: 32 },
                    { x: [85, 0], y: 26 },
                    { x: [90, 1], y: 38 },
                    { x: [72, 0], y: 19 },
                    { x: [78, 1], y: 30 }
                ],
                question: "Predict sales for a weekday (0) when temperature is 82¬∞F.",
                testInput: [82, 0]
            },
            {
                id: 6,
                title: "Crop Yield Prediction",
                context: "A farmer wants to optimize crop yields by understanding how fertilizer amount, rainfall, and temperature affect wheat production per acre.",
                features: ["Fertilizer (kg/acre)", "Rainfall (inches)", "Avg Temp (¬∞F)"],
                target: "Yield (bushels/acre)",
                data: [
                    { x: [100, 20, 68], y: 45 },
                    { x: [150, 25, 70], y: 52 },
                    { x: [120, 18, 65], y: 42 },
                    { x: [180, 30, 72], y: 58 },
                    { x: [140, 22, 69], y: 48 },
                    { x: [160, 28, 71], y: 55 },
                    { x: [110, 19, 67], y: 44 },
                    { x: [170, 26, 70], y: 54 }
                ],
                question: "Predict the yield with 130 kg fertilizer, 24 inches rainfall, and 69¬∞F average temperature.",
                testInput: [130, 24, 69]
            },
            {
                id: 7,
                title: "Online Ad Performance",
                context: "A digital marketing team analyzes how ad spend, time of day, and target audience size affect click-through rates. Optimize your next campaign!",
                features: ["Ad Spend ($100s)", "Hour of Day", "Audience Size (1000s)", "Mobile (0=No, 1=Yes)"],
                target: "Clicks (100s)",
                data: [
                    { x: [5, 14, 50, 1], y: 12 },
                    { x: [8, 18, 75, 1], y: 18 },
                    { x: [6, 10, 40, 0], y: 10 },
                    { x: [10, 20, 100, 1], y: 22 },
                    { x: [7, 12, 60, 0], y: 13 },
                    { x: [9, 16, 80, 1], y: 19 },
                    { x: [4, 8, 35, 0], y: 8 },
                    { x: [11, 19, 90, 1], y: 24 }
                ],
                question: "Predict clicks for $750 spend at 3 PM (15:00), targeting 70k people on mobile devices.",
                testInput: [7.5, 15, 70, 1]
            }
        ];

        // Initialize app
        let currentProblem = null;
        let studentPrediction = null;
        let actualPrediction = null;

        function initApp() {
            renderProblemSelector();
            renderProblems();
            showProblem(1);
        }

        function renderProblemSelector() {
            const selector = document.getElementById('problemSelector');
            selector.innerHTML = problems.map(p => 
                `<button class="problem-btn" onclick="showProblem(${p.id})">
                    Problem ${p.id}
                </button>`
            ).join('');
        }

        function renderProblems() {
            const container = document.getElementById('problemsContainer');
            container.innerHTML = problems.map(p => {
                const tableHeaders = p.features.map(f => `<th>${f}</th>`).join('') + `<th>${p.target}</th>`;
                const tableRows = p.data.map(d => {
                    const cells = d.x.map(val => `<td>${val}</td>`).join('') + `<td>${d.y}</td>`;
                    return `<tr>${cells}</tr>`;
                }).join('');
                
                const featureValues = p.features.map((f, i) => 
                    `<div class="input-group">
                        <label>${f}:</label>
                        <strong>${p.testInput[i]}</strong>
                    </div>`
                ).join('');
                
                return `
                    <div class="problem-container" id="problem-${p.id}">
                        <div class="context">
                            <h3>${p.title}</h3>
                            <p>${p.context}</p>
                        </div>
                        
                        <h4 style="margin-bottom: 10px;">üìã Training Data:</h4>
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>${tableHeaders}</tr>
                                </thead>
                                <tbody>
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <button class="btn btn-secondary" onclick="copyDataAsCSV(${p.id}, event)" style="padding: 8px 20px; font-size: 0.9em;">
                                üìã Copy Data as CSV
                            </button>
                        </div>
                        
                        <div class="prediction-section">
                            <h4>üéØ Your Task:</h4>
                            <p><strong>Given the following feature values, what would the model predict for ${p.target}?</strong></p>
                            
                            <div style="margin-top: 20px;">
                                ${featureValues}
                            </div>
                            
                            <p style="margin-top: 15px; font-style: italic;">Think about your prediction, then click the button below to see the model's answer.</p>
                            
                            <div class="button-group">
                                <button class="btn btn-primary" onclick="checkAnswer(${p.id})">
                                    üîç Reveal Model Prediction
                                </button>
                                <button class="btn btn-secondary" onclick="resetProblem(${p.id})">
                                    üîÑ Reset
                                </button>
                            </div>
                        </div>
                        
                        <div class="result-section" id="result-${p.id}"></div>
                    </div>
                `;
            }).join('');
        }

        function showProblem(id) {
            // Update button states
            document.querySelectorAll('.problem-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx + 1 === id);
            });
            
            // Show selected problem
            document.querySelectorAll('.problem-container').forEach(container => {
                container.classList.remove('active');
            });
            document.getElementById(`problem-${id}`).classList.add('active');
            
            currentProblem = problems.find(p => p.id === id);
        }

        function checkAnswer(id) {
            const problem = problems.find(p => p.id === id);
            
            // Use pre-defined test inputs
            const features = problem.testInput;
            
            // Calculate regression
            const X = problem.data.map(d => d.x);
            const y = problem.data.map(d => d.y);
            
            let model;
            if (problem.features.length === 1) {
                // Simple linear regression
                model = RegressionCalculator.simpleLinearRegression(X.map(x => x[0]), y);
            } else {
                // Multiple linear regression
                model = RegressionCalculator.multipleLinearRegression(X, y);
            }
            
            actualPrediction = RegressionCalculator.predict(model.coefficients, features);
            
            // Display results
            displayResults(id, model.coefficients, features, actualPrediction, problem);
        }

        function displayResults(id, coefficients, features, actualPred, problem) {
            const resultDiv = document.getElementById(`result-${id}`);
            
            // Build equation string
            let equation = `≈∑ = ${coefficients[0].toFixed(2)}`;
            problem.features.forEach((feature, i) => {
                const sign = coefficients[i + 1] >= 0 ? '+' : '';
                equation += ` ${sign} ${coefficients[i + 1].toFixed(2)}(${feature})`;
            });
            
            // Build feature substitution string
            let substitution = `≈∑ = ${coefficients[0].toFixed(2)}`;
            problem.features.forEach((feature, i) => {
                const sign = coefficients[i + 1] >= 0 ? '+' : '';
                substitution += ` ${sign} ${coefficients[i + 1].toFixed(2)}(${features[i]})`;
            });
            
            resultDiv.innerHTML = `
                <h4>‚úÖ Model Prediction:</h4>
                <p><strong>Regression Equation:</strong></p>
                <div class="equation">${equation}</div>
                
                <p><strong>Substituting the values:</strong></p>
                <div class="equation">${substitution} = ${actualPred.toFixed(2)}</div>
                
                <div class="comparison-box" style="max-width: 300px; margin: 20px auto;">
                    <h5>Predicted ${problem.target}:</h5>
                    <div class="value" style="font-size: 2em;">${actualPred.toFixed(2)}</div>
                </div>
            `;
            
            resultDiv.classList.add('show');
        }

        function copyDataAsCSV(id, event) {
            const problem = problems.find(p => p.id === id);
            
            // Create CSV header
            const headers = [...problem.features, problem.target].join(',');
            
            // Create CSV rows
            const rows = problem.data.map(d => {
                return [...d.x, d.y].join(',');
            }).join('\n');
            
            // Combine header and rows
            const csv = headers + '\n' + rows;
            
            // Fallback method using textarea (works in all contexts)
            const textarea = document.createElement('textarea');
            textarea.value = csv;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                // Show temporary success message
                const button = event ? event.target : document.querySelector(`#problem-${id} .btn-secondary`);
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ Copied!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '';
                }, 2000);
            } catch (err) {
                document.body.removeChild(textarea);
                alert('Failed to copy data. Please try selecting and copying the data manually from the table.');
                console.error('Copy failed:', err);
            }
        }

        function resetProblem(id) {
            // Hide result
            const resultDiv = document.getElementById(`result-${id}`);
            resultDiv.classList.remove('show');
        }

        // Start the app
        initApp();
    </script>
</body>
</html>
